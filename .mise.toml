[tools]
python = "3.14"
pnpm = "latest"
node = "latest"

[env]
_.python.venv = { path = "backend/.venv", create = true }

[tasks.install]
run = """
pushd backend && uv pip install -e ".[dev]" && popd
pushd frontend && pnpm install && popd
"""

[tasks.test]
description = "Run all tests"
run = """
pushd backend && pytest -v tests/ || popd
pushd frontend && pnpm run test || popd
"""

[tasks."test:backend"]
description = "Run backend tests"
run = "cd backend && pytest -v"

[tasks."test:frontend"]
run = "cd frontend && pnpm test"

[tasks.build]
run = "cd frontend && pnpm build"

[tasks.lint]
run = """
cd backend && ruff check .
cd frontend && pnpm build
"""

[tasks.worktree]
description = "Create new git worktree"
run = """
#!/usr/bin/env bash
set -e
BRANCH=${1:-$(git branch --show-current)-wt}
DIR="../$(basename $PWD)-wt-$BRANCH"
git worktree add "$DIR" -b "$BRANCH"
cd "$DIR"
mise trust
mise install
mise run install
echo "Worktree ready: $DIR"
"""